@{
    ViewBag.Title = Proestimator.Resources.ProStrings.Support;
}

<style>

    #formHeadline ul {
        text-align: left;
        font-size: 1.2em;
    }

    #formHeadline a {
        font-weight: bold;
        color: black;
        text-decoration: underline;
    }

        #formHeadline a:hover {
            font-weight: bold;
            color: black;
            text-decoration: underline;
        }

    h1 {
        text-align: left;
        padding-left: 20px;
        padding-top: 20px;
        margin-bottom: 0px;
    }

    #chatPage {
        height: 100%;
    }

    #chatHistory {
        overflow-y: auto;
        padding: 10px;
        border-bottom: 1px solid #ccc;
        height: 400px;
    }

    #chatInputArea {
        padding: 10px;
        border-top: 1px solid #ccc;
        align-items: center;
    }

    #userInput {
        height: 50px;
        resize: none;
        margin-right: 10px;
    }

    #submitButton {
        height: 50px;
    }

    .message {
        padding: 10px;
        border-bottom: 1px solid #eee;
    }

    .user {
        text-align: right;
        color: blue;
    }

    .server {
        text-align: left;
        color: green;
    }


</style>

<script>
    $(document).ready(function () {
        $("#userInput").on('keypress', function (e) {
            if (e.which == 13) {
                $("#submitButton").click();
            }
        });

        $("#submitButton").click(function() {
            var inputText = $("#userInput").val();

            // clear the input
            $("#userInput").val("");
            $("#userInput").focus(); 

            AddChatHistory(inputText, false);
            $("#chatHistory").append("<img id='chatLoading' src='/Images/animatedCircle.gif' />");

            // Ajax request to the server
            $.ajax({
                url: '@Url.Action("GetChatResponse", "Help")',
                type: "POST",
                data: { question: inputText },
                success: function(response) {
                    var serverResponse = response;
                    $("#chatLoading").remove();
                    AddChatHistory(serverResponse, true);
                }
            });
        });

        $("#userInput").focus();

        AddChatHistory("Hi, I am an AI powered chat bot, I am here to answer your questions about ProEstimator.", true);
    });

    function AddChatHistory(message, fromServer) {
        var typeClass = "user";
        if (fromServer === true) {
            typeClass = "server";
        }

        var newDiv = $("<div />")
            .html(message)
            .addClass("message")
            .addClass(typeClass)
            .css('display', 'none');

        var chatHistory = $("#chatHistory");

        chatHistory.append(newDiv);
        newDiv.fadeIn();

        chatHistory.scrollTop(chatHistory.scrollHeight);
    }
</script>

<div id="workDesk">

    <div id="chatPage">
        <div id="chatHistory">
            <!-- Chat history will go here -->
        </div>

        <div id="chatInputArea">
            <textarea id="userInput"></textarea>
            <button id="submitButton">Submit</button>
        </div>
    </div>

</div>
