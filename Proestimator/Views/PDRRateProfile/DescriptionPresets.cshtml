@model Proestimator.ViewModel.PDR.DescriptionPresetsVM

@using Proestimator.ViewModel.PDR;

@{
    ViewBag.Title = Proestimator.Resources.PDRStrings.Title_DescriptionPresets;

}

<link href="@Url.Content("~/Content/css/PDR_RateProfiles.css")" rel="stylesheet" type="text/css" />

<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script type="text/javascript">

    $(document).ready(function () {

        $("#btnNew").click(function () {
            $.getJSON('@Url.Action("AddPreset", "PDRRateProfile")', { userID: @ViewBag.UserID, loginID: @Model.LoginID }, function (data) {
                if (data.Success == true) {
                    ShowMessage("@Proestimator.Resources.PDRStrings.PresetAdded.");

                    var newRow =
                    "<tr id='" + data.DataItem.ID + "'> \
                        <td><input autocomplete='off' id='DescriptionPresets_" + data.DataItem.Index + "__Text' name='DescriptionPresets[" + data.DataItem.Index + "].Text' type='text' value='" + data.DataItem.Text + "' /></td> \
                        <td> \
                            <input data-val='true' data-val-number='The field ID must be a number.' data-val-required='The ID field is required.' id='DescriptionPresets_" + data.DataItem.Index + "__ID' name='DescriptionPresets[" + data.DataItem.Index + "].ID' type='hidden' value='" + data.DataItem.ID + "' /> \
                            <input type='button' id='delete_" + data.DataItem.ID + "' title='Delete' value='Delete' class='button btnDelete'></td> \
                    </tr>";

                    $(newRow).hide().appendTo("#presetTable tbody").fadeIn(500);

                    $("#delete_" + data.DataItem.ID).click(function () {
                        DeletePreset(data.DataItem.ID);
                    });

                } else {
                    ShowMessage(data.ErrorMessage);
                }
            });
        });

        $(".btnDelete").click(function () {
            var multiplierID = $(this).attr("id").replace("delete_", "");
            DeletePreset(multiplierID);
        });

        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <text>
            ShowMessage("@Model.ErrorMessage");
            </text>
        }
    });

    function DeletePreset(id)
    {
        $.getJSON('@Url.Action("DeletePreset", "PDRRateProfile")', { userID: @ViewBag.UserID, loginID: @Model.LoginID, id: id }, function (data) {
            if (data.Success == true) {
                ShowMessage("@Proestimator.Resources.PDRStrings.PresetDeleted.");
                $("#" + id).fadeOut(500, function() {
                    $("#" + id).remove();
                });
            } else {
                ShowMessage(data.ErrorMessage);
            }
        });
    }

    function ShowMessage(message) {
        var newP = $(document.createElement('p'));
        newP.text(message);

        $(".message-container").append(newP);

        window.setTimeout(function () {
            $(".message-container").empty();
        }, 4000);
    }

</script>

<style>
    .btnDelete {
        margin-top: -10px;
    }
</style>

@using (Html.BeginForm("DescriptionPresets", "PDRRateProfile", FormMethod.Post, new { @class = "container", @style = "margin-top: 20px;" }))
{
    <input type="hidden" id="redirectData" name="redirectDataField" />

    <a class="button nav-btn" href="javascript:SubmitAndRedirect('/@ViewBag.UserID/rates?t=2');">&lt;&lt; PDR Rate Profiles</a>

    <h1>PDR Presets</h1>

    if (Model.GoodData)
    {
        <table style="width: 90%; max-width: 600px; margin: 0px auto; padding-top: 40px;" id="presetTable">
            <thead>
                <tr>
                    <td><b>@Proestimator.Resources.PDRStrings.Description</b></td>
                    <td></td>
                </tr>
            </thead>

            <tbody>
                @for (int i = 0; i < Model.DescriptionPresets.Count; i++)
                {
                    <tr id="@Model.DescriptionPresets[i].ID">
                        <td>@Html.TextBoxFor(o => o.DescriptionPresets[i].Text, new { autocomplete = "off" })</td>
                        <td>
                            @Html.HiddenFor(o => o.DescriptionPresets[i].ID)
                            <input type="button" id="delete_@Model.DescriptionPresets[i].ID" title="@Proestimator.Resources.ProStrings.Delete" value="@Proestimator.Resources.ProStrings.Delete" class="button btnDelete">
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <div class="center" style="padding-top: 20px;">
            <a class="button nav-btn" id="btnNew">@Proestimator.Resources.ProStrings.NewPreset</a>
            <input id="submitButton" type="submit" value="@Proestimator.Resources.ProStrings.Save" class="button nav-btn" />

            <div class="message-container">

            </div>
        </div>
    }
    else
    {
        <h1>@Proestimator.Resources.PDRStrings.InvalidData</h1>
    }

}
