@model Proestimator.ViewModel.VehicleVM

@using ProEstimatorData.Models.SubModel
@{

    ViewBag.Title = Proestimator.Resources.ProStrings.Vehicle;
    var vehicleinfo = Model;
}
<script type="text/javascript">

    var _poiSections = new Array(@Model.POISectionsArray.Count);

    var lineItemsExist = '@Model.EstimateLineItemsExist' === 'True';
    var allowEstimateVehicleModsWithLineItems = '@Model.AllowEstimateVehicleModsWithLineItems' === 'True';
    var priorVehicleYear = '@Model.Year';
    var priorVehicleMake = '@Model.Make';
    var priorVehicleModel = '@Model.Model';
    var priorVehicleTrim = '@Model.Trim';
    var priorVehicleBody = '@Model.Body';
    
    @foreach (KeyValuePair<int, string> pair in Model.POISectionsArray)
    {
        @:_poiSections[@pair.Key] = '@pair.Value';
        }

    console.log(_poiSections);
    //alert('Unable to decode please click Choose File again and take a clearer picture. Make sure there is nothing obscuring the barcode such as glare from the sun, lights, or your cameras flash.');

    $(document).ready(function () {

        var paintTypeOnload = $('#PaintType').val();
        $("#submitButton").removeAttr("disabled");

        @if(Model.Carfax && Model.CarfaxInfo) {<text> $('#moreInfo').show(); </text>}

        $("#uploadLicensePlateImage").change(function () {

            $("#uploadLicensePlateMessage").hide();
            $("#uploadLicensePlateMessage").text("");

            var data = new FormData();
            var files = $("#uploadLicensePlateImage").get(0).files;
            if (files.length > 0) {
                $("#uploadLicensePlateMessage").show();
                $("#uploadLicensePlateMessage").text("@Proestimator.Resources.ProStrings.UploadingImage...");

                data.append("Images", files[0]);

                $.ajax({
                    url: "/Estimate/DecodeLicensePlateImage",
                    type: "POST",
                    processData: false,
                    contentType: false,
                    data: data,
                    success: function (response) {
                        if (response.ErrorMessage === '') {
                            if (response.LicensePlateNumber != '') {
                                $("#LicenseDecode").val(response.LicensePlateNumber);
                                $("#License").val(response.LicensePlateNumber);
                                $("#LicenseStateDecode").val(response.LicensePlateStateAbbreviation);
                                $("#LicenseState").val(response.LicensePlateStateAbbreviation);

                                var userMessage = "";
                                if (response.CorrectPlateNumberConfidenceScore < .7 || response.CorrectPlateStateConfidenceScore < .4) {
                                    userMessage = "@Proestimator.Resources.ProStrings.UploadLicensePlatePhoto_LowConfidenceReading";
                                }

                                if (response.LicensePlateStateAbbreviation != '') {
                                    var checkAndLogVehicleModResult = CheckAndLogVehicleMod();
                                    if (checkAndLogVehicleModResult) {
                                        ClearVinYearMakeModelAndVehicleTypes();
                                    }
                                    HandlePlateStateBtnOnClick(userMessage, checkAndLogVehicleModResult);
                                } else if (userMessage !== "") {
                                    ShowUserMessage(userMessage, true, 10000);
                                }
                            }
                        }
                        else {
                            ShowUserMessage(response.ErrorMessage, true, 10000);
                        }

                        $("#uploadLicensePlateMessage").hide();
                        $("#uploadLicensePlateImage").val('');
                    },
                    error: function (er) {
                        ShowUserMessage("Error when attempting to upload or read image: " + er, true, 10000);
                        $("#uploadLicensePlateMessage").hide();
                        $("#uploadLicensePlateImage").val('');
                    }
                });
            }

            $("#uploadLicensePlateImage").html($("#uploadLicensePlateImage").html());
        });

        // Set up the camera image vin decoder
        $("#uploadImage").change(function () {

            $("#uploadMessage").text("@Proestimator.Resources.ProStrings.UploadingImage...");
            console.debug("Upload image changed");

            var data = new FormData();
            var files = $("#uploadImage").get(0).files;
            if (files.length > 0) {
                data.append("Images", files[0]);
            }

            $.ajax({
                url: "/Estimate/DecodeVINImage",
                type: "POST",
                processData: false,
                contentType: false,
                data: data,
                success: function (response) {
                    console.debug(response);

                    if (response.Success == true) {
                        $("#uploadMessage").text("@Proestimator.Resources.ProStrings.VINDecoded.");

                        $("#Vin").val(response.VIN);
                        $("#vinBtn").click();
                    }
                    else {
                        $("#uploadMessage").text(response.ErrorMessage);
                    }
                },
                error: function (er) {
                    $("#uploadMessage").text("@Proestimator.Resources.ProStrings.ErrorDecodingVINImage: " + er);
                }
            });

            $("#uploadImage").html($("#uploadImage").html());

            $(".VINDecodeMessage").click(function () {
                $(this).hide(400);
                clearTimeout(timer);
            });
        });

        $("#modal-window").dialog({
            autoOpen: false,
            modal: true,
            title: "Paint Type Changed",
            //width: 950,
            width: $(window).width() * 0.30,
            modal: true,
            close: function () {
                console.log("vehicle.csthml");
                $("#submitButton").removeAttr("disabled");
            },
            buttons: [
            {
                id: "Yes",
                text: "Yes",
                click: function () {
                    $("#UpdatingExistingLineItems").val("true");
                    $("#estimateForm").submit();
                    $(this).dialog('close');
                }
            },
            {
                id: "No",
                text: "No",
                click: function () {
                    $("#UpdatingExistingLineItems").val("false");
                    $("#estimateForm").submit();
                    $(this).dialog('close');
                }
            }
            ]
        });

        $("#modal-window-mandatory-fields").dialog({
            autoOpen: false,
            modal: true,
            title: "@Proestimator.Resources.ProStrings.VehicleMandatoryFieldsHeader",
            //width: 950,
            width: $(window).width() * 0.30,
            modal: true,
            close: function () {
                console.log("vehicle.csthml");
                $("#submitButton").removeAttr("disabled");
            },
            buttons: [
                {
                    id: "Yes",
                    text: "OK",
                    click: function () {
                        $("#estimateForm").submit();
                        $(this).dialog('close');
                    }
                }
            ]
        });

        $("#submitButton").click(function () {

            var licensePlateDecode = $("#vinNumberSet").find("#License").val();
            var licensePlateVehicle = $("#addressFieldSet").find("#License").val();

            if (licensePlateDecode == "" && licensePlateVehicle != "") {
                $("#vinNumberSet").find("#License").val(licensePlateVehicle);
            }

            if(paintTypeOnload != $('#PaintType').val() && lineItemsExist) {
                $('#modal-window').dialog('open');
            }
            else {
                if (($('#Year').val() == '0' || $('#Make').val() == '0' || $('#Model').val() == '0' || $('#Trim').val() == '0' ||
                    $('#Body').val() == '0') && $('#ManualSelection').val() == 'false') {
                    $('#modal-window-mandatory-fields').dialog('open');
                }
                else {
                    $("#UpdatingExistingLineItems").val("false");
                    $("#estimateForm").submit();
                }
            }
        });

        $('#estimateForm').find('input, select, textarea')
                      .add('[form=myformid]')
                      .not(':disabled')
                      .each(function () {
                          $(this).addClass('ChangeClass');

                      });

        $(".selectall").click(function () {
            this.setSelectionRange(0, this.value.length);
        });

        $('#License').change(function () {
            $('#LicenseDecode').val($('#License').val());
        });

        $('#LicenseDecode').change(function () {
            $('#License').val($('#LicenseDecode').val());
        });

        $('#LicenseState').change(function () {
            $('#LicenseStateDecode').val($('#LicenseState').val());
        });

        $('#LicenseStateDecode').change(function () {
            $('#LicenseState').val($('#LicenseStateDecode').val());
        });

        var _allowEstimateVehicleModsWithLineItems_Confirmed = false
        function CheckAndLogVehicleMod() {
            if (!lineItemsExist || _allowEstimateVehicleModsWithLineItems_Confirmed)
                return true;

            LogMiscInfo(@Model.UserID, @Model.EstimateID, "EstimateWithPartsVechicleModAttempted");
            if (allowEstimateVehicleModsWithLineItems) {
                if (confirm("@Proestimator.Resources.ProStrings.EstimateVechicleMustRemovePartsConfirm")) {
                    _allowEstimateVehicleModsWithLineItems_Confirmed = true;
                    LogMiscInfo(@Model.UserID, @Model.EstimateID, "EstimateWithPartsVechicleModAccepted");
                    return true;
                }

                LogMiscInfo(@Model.UserID, @Model.EstimateID, "EstimateWithPartsVechicleModDeclined");
            } else {
                ShowUserMessage("@Proestimator.Resources.ProStrings.EstimateVechicleMustRemoveParts", true, 15000, true);
            }

            return false;
        }

        function AlertAndRevertValueIfHasLineItems(cntrl, priorValue) {
            if (cntrl.val() !== priorValue && !CheckAndLogVehicleMod()) {
                cntrl.val(priorValue);
                return true;
            }

            return false;
        }

        $('#Year').change(function () {

            if (AlertAndRevertValueIfHasLineItems($('#Year'), priorVehicleYear)) {
                return;
            }

            // HideFrameDataMessage();
            GetMakes();
            HideVehicleMatchMessage();
        });

        $('#Make').change(function () {
            if (AlertAndRevertValueIfHasLineItems($('#Make'), priorVehicleMake)) {
                return;
            }

            // HideFrameDataMessage();
            GetModels();
            HideVehicleMatchMessage();
        });

        $('#Model').change(function () {
            if (AlertAndRevertValueIfHasLineItems($('#Model'), priorVehicleModel)) {
                return;
            }

            GetSubModels();
            HideVehicleMatchMessage();
        });

        $('#Trim').change(function () {
            if (AlertAndRevertValueIfHasLineItems($('#Trim'), priorVehicleTrim)) {
                return;
            }

            GetBodyTypes();
            GetEngineTypes();
            GetTransmissionTypes();
            GetDriveTypes();
            GetPaintCodes();
            CheckIfVehicleDataExists();
        });

        $('#Body').change(function () {
            if (AlertAndRevertValueIfHasLineItems($('#Body'), priorVehicleBody)) {
                return;
            }

            GetEngineTypes();
            GetTransmissionTypes();
            GetDriveTypes();
            GetPaintCodes();
        });

        function ClearVinYearMakeModelAndVehicleTypes() {
            $("#Vin").val('');
            ClearVehicleTypeDLLS();
            $("#Year").val('0');
            ClearDDL('Make');
            ClearDDL('Model');
            ClearDDL('Trim');
        }

        function GetMakes() {
            SetLoadingMessage('Make');

            ClearDDL('Model');
            ClearDDL('Trim');
            ClearVehicleTypeDLLS();

            var Year = $('#Year').val();

            $.getJSON("@Url.Action("GetAllMakes", "Estimate")", { userID: @ViewBag.UserID, year: Year },
                function (data) {
                    ClearDDL('Make');
                    var select = $("#Make");

                    $.each(data, function (index, itemData) {
                        select.append($('<option/>', {
                            value: itemData.Value,
                            text: itemData.Text
                        }));
                    });
                });
        }

        function ClearVehicleTypeDLLS() {
            ClearDDL('Body');
            ClearDDL('DriveType');
            ClearDDL('Engine');
            ClearDDL('Trans');
            ClearDDL('PaintCode');
            ClearDDL('PaintCode2');
        }

        function GetModels() {
            SetLoadingMessage('Model');
            ClearDDL('Trim');
            ClearVehicleTypeDLLS();

            var Year = $('#Year').val();
            var Make = $('#Make').val();

            $.getJSON("@Url.Action("GetAllModels", "Estimate")", { userID: @ViewBag.UserID, year: Year, makeid: Make },
                function (data) {
                    ClearDDL('Model');
                    var select = $("#Model");

                    $.each(data, function (index, itemData) {
                        select.append($('<option/>', {
                            value: itemData.Value,
                            text: itemData.Text
                        }));
                    });
                });
        }

        function GetSubModels() {
            SetLoadingMessage('Trim');
            ClearDDL('Body');
            ClearVehicleTypeDLLS();

            var Year = $('#Year').val();
            var Make = $('#Make').val();
            var Model = $('#Model').val();

            $.getJSON("@Url.Action("GetAllSubModels", "Estimate")", { userID: @ViewBag.UserID, year: Year, makeid: Make, modelid: Model },
                function (data) {
                    ClearDDL('Trim');
                    var select = $("#Trim");

                    $.each(data, function (index, itemData) {
                        select.append($('<option/>', {
                            value: itemData.Value,
                            text: itemData.Text
                        }));
                    });
                });
        }

        function GetBodyTypes() {
            SetLoadingMessage('Body');

            var Year = $('#Year').val();
            var Make = $('#Make').val();
            var Model = $('#Model').val();
            var SubModel = $('#Trim').val();

            $.getJSON("@Url.Action("GetBodyTypes", "Estimate")", { userID: @ViewBag.UserID, year: Year, makeid: Make, modelid: Model, subModelID: SubModel },
               function (data) {
                   ClearDDL('Body');
                   var select = $("#Body");

                   $.each(data, function (index, itemData) {
                       select.append($('<option/>', {
                           value: itemData.Value,
                           text: itemData.Text
                       }));
                   });

                   if(data.length == 2) {
                       $("#Body").prop("selectedIndex", 1)
                   }
               });
        }

        function GetEngineTypes() {
            var selectedEngine = $('#Engine').val();
            if (!selectedEngine) {
                selectedEngine = 0;
            }
            SetLoadingMessage('Engine');

            var Year = $('#Year').val();
            var Make = $('#Make').val();
            var Model = $('#Model').val();
            var SubModel = $('#Trim').val();
            var BodyID = $('#Body').val();
            console.debug("BodyID: " + BodyID);

            $.getJSON("@Url.Action("GetEngineTypes","Estimate")", { userID: @ViewBag.UserID, estimateID: @Model.EstimateID, year: Year, makeid: Make, modelid: Model, subModelID: SubModel, bodyID: BodyID },
            function (data) {
                ClearDDL('Engine');
                var select = $('#Engine');

                $.each(data, function (index, itemdata) {
                    select.append($('<option/>', {
                        value: itemdata.Value,
                        text: itemdata.Text
                    }));
                });

                select.val(selectedEngine);
                if (!select.val()) {
                    select.val(0);
                }
            });
        }

        function GetTransmissionTypes() {
            var selectedTransmission = $('#Trans').val();
            if (!selectedTransmission) {
                selectedTransmission = 0;
            }
            SetLoadingMessage('Trans');

            var Year = $('#Year').val();
            var Make = $('#Make').val();
            var Model = $('#Model').val();
            var SubModel = $('#Trim').val();
            var BodyID = $('#Body').val();

            $.getJSON("@Url.Action("GetTransmissionTypes", "Estimate")", { userID: @ViewBag.UserID, estimateID: @Model.EstimateID, year: Year, makeid: Make, modelid: Model, subModelID: SubModel, bodyID: BodyID },
                function (data) {
                    ClearDDL('Trans');
                    var select = $('#Trans');

                    $.each(data, function (index, itemdata) {
                        select.append($('<option/>', {
                            value: itemdata.Value,
                            text: itemdata.Text
                        }));
                    });

                    select.val(selectedTransmission);
                    if (!select.val()) {
                        select.val(0);
                    }
                });
        }

        function GetDriveTypes() {
            var selectedDriveType = $('#DriveType').val();
            if (!selectedDriveType) {
                selectedDriveType = 0;
            }
            SetLoadingMessage('DriveType');

            var Year = $('#Year').val();
            var Make = $('#Make').val();
            var Model = $('#Model').val();
            var SubModel = $('#Trim').val();

            $.getJSON("@Url.Action("GetDriveTypes","Estimate")", { userID: @ViewBag.UserID, estimateID: @Model.EstimateID, year: Year, makeid: Make, modelid: Model, subModelID: SubModel },
            function (data) {
                ClearDDL('DriveType');
                var select = $('#DriveType');
                $.each(data, function (index, itemdata) {
                    select.append($('<option/>', {
                        value: itemdata.Value,
                        text: itemdata.Text
                    }));
                });

                select.val(selectedDriveType);
                if (!select.val()) {
                    select.val(0);
                }
            });
        }


        $("#PaintCode").change(function () {
            var select = $("#PaintCode option:selected").text();
            $("#ExteriorColor").val(select);
        });

        $("#PaintCode2").change(function () {
            var select = $("#PaintCode2 option:selected").text();
            $("#ExteriorColor2").val(select);
        });

        $("#modal-window-vehicle").dialog({
            autoOpen: false,
            modal: true,
            title: "Vehicle Info",
            width: $(window).width() * 0.30,
            height: $(window).height() * 0.50
        });

        $("#Vin").on("input", function (e) {

            var vinInput = $("#Vin").val().toUpperCase();
            var vinNumber = vinInput.replace(/[^a-zA-Z0-9]+/g, '').replace("I", "").replace("O", "").replace("Q", "");

            if (vinInput.length == vinNumber.length) {
                $("#vin-bad-character-message").hide();
            }
            else {
                $("#vin-bad-character-message").show();
            }

            if (vinNumber.length > 17) {
                vinNumber = vinNumber.substring(0, 17);
            }

            $("#Vin").val(vinNumber);

            $("#vin-info-label").text(vinNumber.length + " of 17");

        });

        function VinDecode(vinValue) {

            if (!CheckAndLogVehicleMod()) {
                return;
            }

            $("#labelVinMessage").empty();
            $("#labelVinMessageDiv").hide();
            $.getJSON("@Url.Action("VinDecode", "Estimate")", { userID: @ViewBag.UserID, estimateID: @Model.EstimateID, vin: vinValue }, function (data) {
                if (data != "") {
                    FillVehicleInfo(data);
                }
            });
        }

        function HandlePlateStateBtnOnClick(prefixUserMessage, checkAndLogVehicleModResult) {

            var plate = $("#LicenseDecode").val();
            var state = $("#LicenseStateDecode").val();

            if (plate !== undefined &&
                state !== undefined) {
                $("#labelVinMessage").empty();
                $("#labelVinMessageDiv").hide();
                $.getJSON("@Url.Action("PlateStateDecode", "Estimate")", { userID: @ViewBag.UserID, Plate: plate, State: state, estimateID: @Model.EstimateID })
                .done(function (data) {
                    $("#Vin").val('');
                    if (data != "") {
                        $("#Vin").val(data.VehicleInfo.Vin);
                        if (checkAndLogVehicleModResult) {
                            FillVehicleInfo(data);
                        }
                    }
                    $("#LicenseState").val($("#LicenseStateDecode").val());
                    $("#addressFieldSet").find("#License").val($("#License").val());

                    if (prefixUserMessage || $("#Vin").val() === '') {
                        ShowInvalidPlateDecodeMessage(prefixUserMessage);
                    }
                })
                .fail(function () {
                    ShowInvalidPlateDecodeMessage(prefixUserMessage);
                });
            }
        }

        function ShowInvalidPlateDecodeMessage(prefixUserMessage) {
            var userMessage = !prefixUserMessage ? "" : prefixUserMessage;

            if ($("#Vin").val() === '') {
                if (userMessage !== "")
                    userMessage += "<br /><br />";
                userMessage += "@Proestimator.Resources.ProStrings.UploadLicensePlatePhoto_InvalidPlateInfo";
            }

            if (userMessage !== "") {
                ShowUserMessage(userMessage + "<br /><br />", true, 15000, true);
            }
        }

        $("#plateStateBtn").click(function () {
            HandlePlateStateBtnOnClick('', CheckAndLogVehicleMod());
        });

        $("#vinBtn").click(function () {
            var vinValue = $("#Vin").val();

            if (vinValue.length == 17) {
                VinDecode(vinValue);
            }
            else {
                ShowUserMessage('@Proestimator.Resources.ProStrings.VinSearch_InvalidVin', true, 4000);
            }
        });

        $("#modal-window-trim").dialog({
            autoOpen: false,
            modal: true,
            title: 'Select Trim Level',
            position: { my: "left top", at: "left top", of: $("#Trim") },
        });

        $('#VinLink').click(function() {
            var vinLinkVal = $("#VinLink").text();
            $.getJSON("@Url.Action("GetCarfaxInfo", "Estimate")", { userID: @ViewBag.UserID, vin: vinLinkVal },
            function (data) {
                if (data.Success) {
                    var vehicle = "";
                    $.each(data.VehicleInfo, function (index, itemdata) {
                        vehicle += "<tr><td>" + itemdata.Type + "</td><td>" + itemdata.Data + "</td></tr>";
                    });
                    $("#vehicle").html(vehicle);
                    $('#modal-window-vehicle').dialog('open');
                }
                else {
                    ShowUserMessage(data.ErrorMessage, true, 8000);
                }
            });
        });

        var manualSelection = $('#ManualSelection').val();
        console.debug("ManualSelection: " + manualSelection);
        if (manualSelection == 'True') {
            showManual();
        } else {
            showRegular();
        }

        UpdateFormattedText();
        CheckIfVehicleDataExists();

        // Set up POI SVG 1
        $("#POISVG1").find("path").click(function() {
            var selectedID = ($(this).attr("id")).replace("Section", "");

            if ($("#POILabel1").val() == selectedID)
            {
                selectedID = 0;
            }

            $("#POILabel1").val(selectedID);
            $("#POISection1").text(_poiSections[selectedID]);
            SelectPoi1Path(selectedID);
        });

        $("#POISVG1").find("path").hover(
            function() {
                var selectedID = ($(this).attr("id")).replace("Section", "");
                $("#POISection1").text(_poiSections[selectedID]);
            }, function() {
                $("#POISection1").text(_poiSections[$("#POILabel1").val()]);
            }
        );

        SelectPoi1Path($("#POILabel1").val());
        $("#POISection1").text(_poiSections[$("#POILabel1").val()]);

        // Set up POI SVG 2
        $("#POISVG2").find("path").click(function() {
            var selectedID = ($(this).attr("id")).replace("Section", "");

            if ($("#POILabel2").val() == selectedID)
            {
                selectedID = 0;
            }

            $("#POILabel2").val(selectedID);
            $("#POISection2").text(_poiSections[selectedID]);
            SelectPoi2Path(selectedID);
        });

        $("#POISVG2").find("path").hover(
            function() {
                var selectedID = ($(this).attr("id")).replace("Section", "");
                $("#POISection2").text(_poiSections[selectedID]);
            }, function() {
                $("#POISection2").text(_poiSections[$("#POILabel2").val()]);
            }
        );

        SelectPoi2Path($("#POILabel2").val());
        $("#POISection2").text(_poiSections[$("#POILabel2").val()]);

        @if (!ViewBag.Valid) {<text>ShowUserMessage('@Proestimator.Resources.ProStrings.VinSearch_InvalidVin', true, 8000);</text>}

        // RefreshNoFrameDataMessage();
    });         // End of $(document).ready

    function VinClick(vin) {
        $("#labelVinMessage").empty();
        $("#labelVinMessageDiv").hide();
        $("#Vin").val(vin);
        $.getJSON("@Url.Action("VinClick", "Estimate")", { userID: @ViewBag.UserID, estimateID: @Model.EstimateID, vin: vin }, function (data) {
            if (data != "") {
                FillVehicleInfo(data);
            }
        });
    }

    function FillVehicleInfo(data) {
        var yearMatch = false;
        if (data.Success) {
            $.each(data.Years, function (i, item) {
                if (data.Year == item) {
                    yearMatch = true;
                }
            });
        }
        if (data.Success && yearMatch && data.MakeID != 0 && data.ModelID != 0) {
            var years = "";
            $.each(data.Years, function (i, item) {
                years += "<option value='" + item + "'>" + item + "</option>";
            });

            if (years.indexOf('-Select Year-') < 0)
                years = "<option value='0'>-----Select Year-----</option>" + years;

            $("#Year").html(years);
            $("#Year").val(data.Year);

            var makes = "";
            $.each(data.Makes, function (i, item) {
                makes += "<option value='" + item.MakeID + "'>" + item.Make + "</option>";
            });
            $("#Make").html(makes);
            $("#Make").val(data.MakeID);

            var models = "";
            $.each(data.Models, function (i, item) {
                models += "<option value='" + item.ModelID + "'>" + item.Model + "</option>";
            });
            $("#Model").html(models);
            $("#Model").val(data.ModelID);

            var trims = "";
            $.each(data.SubModels, function (i, item) {
                trims += "<option value='" + item.SubModelID + "'>" + item.SubModel + "</option>";
            });
            $("#Trim").html(trims);
            $("#Trim").val(data.SubModelID);

            if (data.SubModelID > 0) {
                CheckIfVehicleDataExists();
            }

            var bodytypes = "";
            $.each(data.BodyTypes, function (i, item) {
                bodytypes += "<option value='" + item.BodyID + "'>" + item.Body + "</option>";
            });
            $("#Body").html(bodytypes);
            $("#Body").val(data.BodyID);

            var enginetypes = "";
            $.each(data.EngineTypes, function (i, item) {
                enginetypes += "<option value='" + item.EngineID + "'>" + item.Engine + "</option>";
            });
            //alert(enginetypes);
            $("#Engine").html(enginetypes);
            $("#Engine").val(data.EngineID);

            var transmissiontypes = "";
            $.each(data.TransmissionTypes, function (i, item) {
                transmissiontypes += "<option value='" + item.TransmissionID + "'>" + item.Transmission + "</option>";
            });
            $("#Trans").html(transmissiontypes);
            $("#Trans").val(data.TransmissionID);

            var drivetypes = "";
            $.each(data.DriveTypes, function (i, item) {
                drivetypes += "<option value='" + item.DriveID + "'>" + item.Drive + "</option>";
            });
            $("#DriveType").html(drivetypes);
            $("#DriveType").val(data.DriveID);

            $("#Vin").show();

            showRegular();
            GetPaintCodes();
            @if (Model.Carfax) {<text> showVinLink(); </text>}
            if (data.SubModelID == 0) {
                $('#modal-window-trim').dialog('open');
            }
        }
        else {
            var vinfo = "";
            if (data.ErrorMessages != "") {
                if (data.ErrorMessages == '@Proestimator.Resources.ProStrings.VinSearch_InvalidVin') {
                    ShowUserMessage('@Proestimator.Resources.ProStrings.VinSearch_InvalidVin', true, 8000);
                }
                else {
                    vinfo += data.ErrorMessages;
                    $.each(data.SimilarVins, function (i, itemdata) {
                        if (i == 0) {
                            vinfo += "<br>However, it is close to the VIN listed below. Click the correct VIN to continue:"
                        }
                        vinfo += "<br><br>" + itemdata.General + "<br>";
                        vinfo += "<a href=\"javascript:void(0)\" style=\"font-weight: bold;color: black; font-size:0.9em; text-decoration: underline;\" onclick=\"VinClick('" + itemdata.Vin + "')\">" + itemdata.Vin + "</a>";
                    });
                    $("#labelVinMessage").html(vinfo);
                    $("#labelVinMessageDiv").show();
                }
            }
            else {
                vinfo += "<b>" + data.VehicleInfo.General + "</b><br>";
                vinfo += "Body style: " + data.VehicleInfo.Body + "<br>";
                vinfo += "Engine: " + data.VehicleInfo.Engine + "<br>";
                vinfo += "Drive type: " + data.VehicleInfo.Drive + "<br>";
                vinfo += "Final Assembly Point: " + data.VehicleInfo.Country + "<br>";
                //vinfo += "Tire Size: " + data.VehicleInfo.Tire + "<br>";
                vinfo += "Transmission type: " + data.VehicleInfo.Transmission;
                ShowUserMessage('@Proestimator.Resources.ProStrings.VinSearch_NoMatches', true, 8000);
                @if (Model.Carfax) {<text> showVinLink(); </text>}
                $("#labelVinMessage").html(vinfo);
                $("#labelVinMessageDiv").show();
            }
        }
    }

    function CheckIfVehicleDataExists() {
        HideVehicleMatchMessage();

        var Year = $('#Year').val();
        var Make = $('#Make').val();
        var Model = $('#Model').val();
        var SubModel = $('#Trim').val();

        if (Year == 0 || Make == 0 || Model == 0)
        {
            return;
        }

        $.getJSON("@Url.Action("CheckVehicleHasData", "Estimate")", { userID: @ViewBag.UserID, year: Year, makeID: Make, modelID: Model, subModelID: SubModel },
            function (data) {
                if (data.CarryUp === true) {
                    ShowVehicleMatchMessage("carry");
                }
                else if (data.HasData === false) {
                    ShowVehicleMatchMessage("data");
                }
            });
    }

    function GetPaintCodes() {
        useData = true;
        $("#PaintCode").data("kendoDropDownList").dataSource.read();
        $("#PaintCode2").data("kendoDropDownList").dataSource.read();
    }

    function HideVehicleMatchMessage() {
        $(".error-message-container").fadeOut();
    }

    function ShowVehicleMatchMessage(messageType) {
        $("#NoVehicleDataMessage").hide();
        $("#CarryUpMessage").hide();

        if (messageType == "data") {
            $("#NoVehicleDataMessage").show();
        }
        else if (messageType == "carry") {
            $("#CarryUpMessage").show();
        }

        $(".error-message-container").fadeIn();
    }

    function SetLoadingMessage(dropDownName) {
        var dropDown = $('#' + dropDownName);
        dropDown.empty();
        dropDown.append($('<option/>', {
            value: "0",
            text: "@Proestimator.Resources.ProStrings.Loading..."
        }));
        dropDown.val(0);
    }

    function ClearDDL(name) {
        if (name == 'PaintCode' || name == 'PaintCode2') {
            ClearPaintCode(name);
        }
        else {
            var ddl = $('#' + name);
            ddl.empty();
            ddl.val(0);
        }
    }

    function ClearPaintCode(name) {
        var ddl = $('#' + name).data("kendoDropDownList");
        var data = ddl.dataSource.data();
        var len = data.length;
        for (var i = 0; i < len; i++) {
            ddl.dataSource.remove(data[0]);
        }
    }

    function showVinLink() {
        $("#VinLink").text($("#Vin").val());
        $('#moreInfo').show();
    }

    function showRegular() {
        $('#vehicleInfoLookup').show();
        $('#vehicleInfoManual').hide();

        $('#tabButtonLookup').addClass('active');
        $('#tabButtonManual').removeClass('active');

        $('#ManualSelection').val(false);
    }

    function showManual() {
        $('#vehicleInfoLookup').hide();
        $('#vehicleInfoManual').show();

        $('#tabButtonLookup').removeClass('active');
        $('#tabButtonManual').addClass('active');

        $('#ManualSelection').val(true);
    }

    function SelectPoi1Path(id)
    {
        $("#POISVG1").find("path").attr("class", "");
        $("#POISVG1").find("#Section" + id).attr("class", "poi-selected");
    }

    function SelectPoi2Path(id)
    {
        $("#POISVG2").find("path").attr("class", "");
        $("#POISVG2").find("#Section" + id).attr("class", "poi-selected");
    }

    var useData = false;

    function GetParameters() {
        return {
            userID: @ViewBag.UserID
            , estimateID: @Model.EstimateID
            , year: $('#Year').val()
            , make: $('#Make').val()
            , model: $('#Model').val()
            , body: $('#Body').val()
            , useData: useData
        };
    }

    function PaintCodeSelectionChanged() {
        $("#ExteriorColor").val(this.text());
    }

    function PaintCode2SelectionChanged() {
        $("#ExteriorColor2").val(this.text());
    }

    function PaintCodeDataChanged() {
        if (this.value() == "") {
            this.value("0");
        }
    }

    @*function HideFrameDataMessage() {
        $("#NoFrameDataMessage").fadeOut();
        $("#YesFrameDataMessage").fadeOut();
    }

    function RefreshNoFrameDataMessage() {
        var Year = $('#Year').val();
        var Make = $('#Make').val();
        var Model = $('#Model').val();

        if (Year == 0 || Make == 0 || Model == 0)
        {
            return;
        }

        Make = $("#Make option:selected").text();
        Model = $("#Model option:selected").text();

        $.getJSON("@Url.Action("NoFrameData", "Estimate")", { year: Year, make: Make, model: Model },
            function (data) {
            if (data === true)
            {
                $("#YesFrameDataMessage").hide();
                $("#NoFrameDataMessage").fadeIn();
            }
            else
            {
                $("#YesFrameDataMessage").fadeIn();
                $("#NoFrameDataMessage").hide();
            }
        });
    }*@
</script>

<style>
    .RequiredCSS {
        color: red;
        font-size: 14px;
        font-weight: bold;
    }

    .hide {
        display: none;
    }

    .poi-svg path {
        fill: white;
        stroke: black;
        stroke-width: 10px;
        cursor: pointer;
    }

        .poi-svg path:hover {
            fill: #7ca0bc;
        }

    .poi-selected {
        fill: #1d69a6 !important;
    }

    .poi-section-label {
        font-size: .85em;
        font-weight: bold;
        height: 12px;
    }

    #FrameDataMessageContainer {
        padding-top: 40px;
        font-size: 0.8em;
        height: 55px;
    }

        #FrameDataMessageContainer p {
            padding: 0px;
            margin: 0px;
            text-align: center;
        }

    @@media screen and (min-width:900px) {
        #FrameDataMessageContainer {
            float: left;
            padding-top: 12px;
            padding-left: 5px;
        }

            #FrameDataMessageContainer p {
                padding: 0px;
                margin: 0px;
            }
    }

    .error-message-container {
        display: none;
        font-size: 0.9em;
        border: 1px solid #d83434;
        background-color: #fbf5f5;
        padding: 0px 10px;
        margin-top: 20px;
    }

    .upload-license-plate-image-label {
        position: relative;
        margin-top: -15px;
        float: right;
        margin-left: 20px;
    }

    .upload-license-plate-image-message {
        position: absolute;
        float: right;
        margin-top: -30px;
        float: right;
        margin-left: 50px;
        white-space: nowrap;
        font-size: 14px;
    }

    .k-dropdown {
        width: 100%;
        margin-bottom: 15px;
        font-size: 14px;
        height: 30px;
        cursor: default;
    }

    .k-dropdown-wrap.k-state-default {
        background: rgba(255,255,255,0.1);
        background-color: #e8eeef;
        border: none;
        box-shadow: 0 1px 0 rgba(0,0,0,0.03) inset;
        height: 30px;
    }

    .k-dropdown-wrap {
        border-radius: 0;
    }

    .k-input {
        text-indent: 15px !important;
    }

    .k-icon {
        cursor: default;
        color: black;
    }

    .k-dropdown-wrap .k-icon:before {
        content: "\e015";
        margin-right: -4px;
    }

    .k-list-scroller {
        background-color: #1d69a6;
        color: white;
    }
    
    .k-list-scroller .k-state-selected {
        background-color: dimgray;
    }

    .k-list-scroller .k-state-focused.k-state-selected {
        box-shadow: none;
    }

    .k-list-scroller .k-state-hover {
        background-color: dimgray;
        color: white;
    }

    .k-popup .k-list .k-item {
        line-height: 15px;
        min-height: 0;
    }
</style>

<div id="workDesk" class="page-container">

    <div id="modal-window" style="display:none;" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    You have changed the vehicle paint type, would you like to update the existing line items to change them to the new paint type?
                </div>
            </div>
        </div>
    </div>
    <div id="modal-window-vehicle" style="display:none;" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <table id="vehicle"></table>
                </div>
            </div>
        </div>
    </div>
    <div id="modal-window-trim" style="display:none;" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    Trim level is not included in the VIN data. Please manually select the trim level.
                </div>
            </div>
        </div>
    </div>
    <div id="modal-window-mandatory-fields" style="display:none;" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    @Proestimator.Resources.ProStrings.VehicleMandatoryFields
                </div>
            </div>
        </div>
    </div>
    @using (Html.BeginForm("Vehicle", "Estimate", FormMethod.Post, new { @id = "estimateForm", @class = "container" }))
    {
        @Html.HiddenFor(o => o.ManualSelection);
        @Html.HiddenFor(o => o.LoginID);
        @Html.HiddenFor(o => o.EstimateID);
        @Html.HiddenFor(o => o.UpdatingExistingLineItems);

        <input type="hidden" id="redirectData" name="redirectDataField" />

        <div id="estimateFormHeader">

            <div id="formHeader-back">
                <a class="button nav-btn" data-link-id="Customer-Back" href="javascript:SubmitAndRedirect('/@ViewBag.UserID/estimate/@Model.EstimateID/customer');">@Proestimator.Resources.ProStrings.CustomerPageBack</a>
            </div>

            <div id="formHeader-center">
                <h1>@Proestimator.Resources.ProStrings.VehicleInfoHeader</h1>

                @if (!Model.EstimateIsLocked)
                {
                    <input id="submitButton" class="button nav-btn" type="button" value="@Proestimator.Resources.ProStrings.Save" />
                }
                @if (Model.EstimateIsLocked)
                {
                    <p class="error-message">@Proestimator.Resources.ProStrings.Estimate_Message_LockedNoEdit</p>
                }

                <p class="error-message">@Model.ErrorMessage</p>
            </div>

            <div id="formHeader-next">
                @if (Model.ManualSelection)
                {
                    <a class="button nav-btn do-not-disable" data-link-id="AddParts-Next" href="javascript:SubmitAndRedirect('/@ViewBag.UserID/estimate/@Model.EstimateID/add-parts-manual');">@Proestimator.Resources.ProStrings.Estimate_Navigation_AddParts >></a>
                }
                else
                {
                    <a class="button nav-btn do-not-disable" data-link-id="AddParts-Next" href="javascript:SubmitAndRedirect('/@ViewBag.UserID/estimate/@Model.EstimateID/add-parts');">@Proestimator.Resources.ProStrings.Estimate_Navigation_AddParts >></a>
                }
            </div>

        </div>

        <div class="form-container">
            <div id="lgRow" class="container">

                @* VIN selection and decoding*@
                <div class="half-container">
                    <fieldset id="vinNumberSet">
                        <legend>
                            @Proestimator.Resources.ProStrings.VinSearch_LookupFromLicense
                            <label for="uploadLicensePlateImage" class="upload-license-plate-image-label">
                                <img title="@Proestimator.Resources.ProStrings.UploadLicensePlatePhoto_LinkTitle" src="~/Images/camera.png" style="width: 40px;" />
                                <span id="uploadLicensePlateMessage" class="upload-license-plate-image-message" style="display: none;"></span>
                            </label>
                            <input class="box__file" type="file" id="uploadLicensePlateImage" style="display:none;" />
                        </legend>

                        <div class="field-wrapper">
                            <div class="field-wrapper">
                                <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.LicenseNo</label>
                                <div class="field-control">
                                    @Html.TextBoxFor(model => model.LicenseDecode, new { @class = "col text-uppercase", autocomplete = "off" })<br />
                                </div>
                            </div>
                            <div class="field-wrapper">
                                <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.LicenseState</label>
                                <div class="field-control">
                                    @Html.DropDownListFor(model => model.LicenseStateDecode, Model.StateDDL, new { @id = "LicenseStateDecode" })
                                </div>
                            </div>
                            <div class="container" style="text-align: right">
                                <div style="width: 70%; float: left;">
                                    <label id="decodeError" style="color: red; text-align: right;">&nbsp;</label>
                                </div>
                                <div style="width: 30%;  float: left;">
                                    <a id="plateStateBtn" class="button do-not-disable">@Proestimator.Resources.ProStrings.DecodeButton</a>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </div>

                <div class="half-container" id="vinContainer">
                    <fieldset>
                        <legend style="float: left;">@Proestimator.Resources.ProStrings.VINHeader</legend>

                        <div class="field-wrapper">

                            @if (1 == 2)
                            {
                                <div class="field-wrapper md_hide">
                                    <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.ScanNote</label>
                                    <div class="field-control">
                                        <input type="file" id="uploadImage" />
                                        <p id="uploadMessage" style="text-align: center;"></p>

                                        <input type="hidden" id="hiddenCamera" value="" />
                                        @Html.HiddenFor(model => model.ServiceBarcode)
                                    </div>
                                </div>
                            }

                            <div class="field-wrapper">
                                <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.VinLabel</label>
                                <div class="field-control">
                                    <div>
                                        @Html.TextBoxFor(model => model.Vin, new { autocomplete = "off", style = "text-transform: uppercase;" })
                                    </div>

                                    <div>
                                        <div style="float: left;">
                                            <p style="margin: 0px; font-size: small;">
                                                <span id="vin-info-label"></span>
                                                <span id="vin-bad-character-message" style="color: red; display: none; margin-left: 5px;">"@Proestimator.Resources.ProStrings.VINBadCharacterMessage"</span>
                                            </p>
                                        </div>
                                        <div style="float: right; margin: 0px;">
                                            <input type="button" class="button do-not-disable" id="vinBtn" style="width: 70px;" value="@Proestimator.Resources.ProStrings.DecodeButton" />
                                        </div>
                                    </div>

                                </div>
                            </div>
                            @if (Model.Carfax)
                            {
                                <div class="field-wrapper" id="moreInfo" style="display: none;">
                                    <label class="inputLabel field-label">More Info From</label>
                                    <div class="field-control">
                                        <div style="float: left;">
                                            <a href="#" id="VinLink" style="font-weight: bold;color: black; font-size:0.9em; text-decoration: underline;">@Model.Vin</a>
                                        </div>
                                    </div>
                                </div>
                            }
                            <div class="field-wrapper">
                                <label class="inputLabel field-label"></label>
                                <div class="field-control">
                                    <div id="labelVinMessageDiv" style="display: none; padding: 5px; border: 1px solid #d83434; text-align: left; float: right; margin-top: 5px;">
                                        <label id="labelVinMessage"></label>
                                    </div>
                                </div>
                            </div>

                            <div class="container">
                                <label id="labelVinMessage2" style="color: red; text-align: left; float: right;"></label>
                                <label id="VINDecodeMessage" style="color: red; text-align: center;display:none;"></label>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>

            <div class="container" style="text-align: center">
                <h6>@Proestimator.Resources.ProStrings.Or</h6>
            </div>

            <ul class="tab">
                <li id="tabButtonLookup"><a href="javascript:void(0)" class="button" onclick="showRegular()">@Proestimator.Resources.ProStrings.Database</a></li>
                <li id="tabButtonManual"><a href="javascript:void(0)" class="button" onclick="showManual()">@Proestimator.Resources.ProStrings.Manual</a></li>
            </ul>

            <div class="tabcontent container">
                <div id="vehicleInfoManual" class="container" style="display: none;">
                    @* The vehicle manual entry form *@
                    <div class="half-container">
                        <fieldset>
                            <legend>
                                @Proestimator.Resources.ProStrings.Vehicle_ManualEntry
                            </legend>

                            <p>@Proestimator.Resources.ProStrings.Vehicle_ManualEntryNote</p>

                            <div class="field-wrapper">
                                <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.Vehicle_Country</label>
                                <div class="field-control">
                                    @Html.TextBoxFor(o => o.ManualCountry, new { autocomplete = "off" })
                                </div>
                            </div>

                            <div class="field-wrapper">
                                <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.Vehicle_Manufacturer</label>
                                <div class="field-control">
                                    @Html.TextBoxFor(o => o.ManualManufacturer, new { autocomplete = "off" })
                                </div>
                            </div>

                            <div class="field-wrapper">
                                <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.Make</label>
                                <div class="field-control">
                                    @Html.TextBoxFor(o => o.ManualMake, new { autocomplete = "off" })
                                </div>
                            </div>

                            <div class="field-wrapper">
                                <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.Model</label>
                                <div class="field-control">
                                    @Html.TextBoxFor(o => o.ManualModel, new { autocomplete = "off" })
                                </div>
                            </div>

                            <div class="field-wrapper">
                                <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.Year</label>
                                <div class="field-control">
                                    @Html.TextBoxFor(o => o.ManualModelYear, new { autocomplete = "off" })
                                </div>
                            </div>

                            <div class="field-wrapper">
                                <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.Trim</label>
                                <div class="field-control">
                                    @Html.TextBoxFor(o => o.ManualSubModel, new { autocomplete = "off" })
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>

                <div id="vehicleInfoLookup" class="container">

                    @* Part 1. Year, Make, Model - Top left form *@
                    <div id="yearMakeModel" class="half-container">
                        <fieldset>
                            <legend>
                                <span class="number">1</span>@Proestimator.Resources.ProStrings.YearMakeModelHeader <i class="RequiredCSS">*</i> <span class="admonishment">@Proestimator.Resources.ProStrings.RequiredVehicleDatabase </span>
                            </legend>
                            
                            <div class="field-wrapper-half">
                                <label class="inputLabel field-label-half">@Proestimator.Resources.ProStrings.Year <i class="RequiredCSS">*</i></label>
                                <div class="field-control-half">
                                    @Html.DropDownListFor(model => model.Year, Model.YearDDL)
                                </div>
                            </div>

                            <div class="field-wrapper-half">
                                <label class="inputLabel field-label-half">@Proestimator.Resources.ProStrings.Make <i class="RequiredCSS">*</i></label>
                                <div class="field-control-half">
                                    @Html.DropDownListFor(model => model.Make, Model.MakeDDL)
                                </div>
                            </div>

                            <div class="field-wrapper-half">
                                <label class="inputLabel field-label-half">@Proestimator.Resources.ProStrings.Model <i class="RequiredCSS">*</i></label>
                                <div class="field-control-half">
                                    @Html.DropDownListFor(model => model.Model, Model.ModelDDL)
                                </div>
                            </div>

                            <div class="field-wrapper-half">
                                <label class="inputLabel field-label-half">@Proestimator.Resources.ProStrings.Trim <i class="RequiredCSS">*</i></label>
                                <div class="field-control-half">
                                    @Html.DropDownListFor(model => model.Trim, Model.SubModelDDL)
                                </div>
                            </div>

                            <div class="field-wrapper-half">
                                <label class="inputLabel field-label-half">@Proestimator.Resources.ProStrings.BodyType <i class="RequiredCSS">*</i></label>
                                <div class="field-control-half">
                                    @Html.DropDownListFor(model => model.Body, Model.BodyTypeDDL)
                                </div>
                            </div>


                            <div class="field-wrapper-half">
                                <label class="inputLabel field-label-half">@Proestimator.Resources.ProStrings.PaintType</label>
                                <div class="field-control-half">
                                    @Html.DropDownListFor(model => model.PaintType, Model.PaintTypesDLL)
                                </div>
                            </div>


                            <div class="field-wrapper">
                                <label class="inputLabel field-label"></label>
                                <div class="field-control">
                                    <a class="button nav-btn" style="float: left;" onclick="SubmitAndRedirect('/@ViewBag.UserID/frame-data/@Model.EstimateID'); stopPropagation(event);">@Proestimator.Resources.ProStrings.FrameButton</a>

                                    @*<div id="FrameDataMessageContainer">
                    <p id="NoFrameDataMessage" style="display: none; color: red;">There is no frame data for the selected vehicle.</p>
                    <p id="YesFrameDataMessage" style="display: none; color: green;">Frame data found.</p>
                </div>*@
                                </div>
                            </div>

                            <div class="field-wrapper">
                                <label class="inputLabel field-label"></label>
                                <div class="field-control error-message-container">
                                    <p id="NoVehicleDataMessage" style="display: none;">We don't yet have part data for the selected vehicle.  You will be able to use part data from a previous year.</p>

                                    <div id="CarryUpMessage" style="display: none;">
                                        <h2>Carry-up Service.</h2>
                                        <p>Specific vehicle not yet available.  The previous model year will be used since there have been no reported major changes.  Some minor differences in parts data are possible.  Please contact your local supplier to verify part numbers and prices.</p>
                                    </div>
                                </div>
                            </div>

                        </fieldset>

                    </div>

                    @* Part 2. Vehicle Types - Top right form *@
                    <div id="typeField" class="half-container">
                        <fieldset>
                            <legend><span class="number">2</span>@Proestimator.Resources.ProStrings.VehicleTypesHeader<span class="inlineNote">  @Proestimator.Resources.ProStrings.NotRequiredNote</span></legend>

                            <div class="field-wrapper-half">
                                <label class="inputLabel field-label-half">@Proestimator.Resources.ProStrings.ProductionYear</label>
                                <div class="field-control-half">
                                    @Html.DropDownListFor(model => model.ProductionYear, Model.YearDDL)
                                </div>
                            </div>

                            <div class="field-wrapper-half">
                                <label class="inputLabel field-label-half">@Proestimator.Resources.ProStrings.ProductionMonth</label>
                                <div class="field-control-half">
                                    @Html.DropDownListFor(model => model.ProductionMonth, Model.ProductionMonthDDL, "-----Select Month----")
                                </div>
                            </div>
                            <div class="field-wrapper">
                                <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.Engine</label>
                                <div class="field-control">
                                    @Html.DropDownListFor(model => model.Engine, Model.EngineDDL)
                                </div>
                            </div>

                            <div class="field-wrapper">
                                <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.Transmission</label>
                                <div class="field-control">
                                    @Html.DropDownListFor(model => model.Trans, Model.TransmissionDDL)
                                </div>
                            </div>

                            <div class="field-wrapper">
                                <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.DriveType</label>
                                <div class="field-control">
                                    @Html.DropDownListFor(model => model.DriveType, Model.DriveTypeDDL)
                                </div>
                            </div>

                            <div class="field-wrapper">
                                <label class="inputLabel field-label">Primary @Proestimator.Resources.ProStrings.PaintCode</label>
                                <div class="field-control">
                                    @(Html.Kendo().DropDownList()
                                        .Name("PaintCode")
                                        .DataTextField("Text")
                                        .DataValueField("Value")
                                        .Filter("contains")
                                        .Events(events => events
                                            .Change("PaintCodeSelectionChanged")
                                            .DataBound("PaintCodeDataChanged")
                                        )
                                        .DataSource(dataSource => dataSource
                                            .Read(read => read.Action("GetPaintCode", "Estimate").Data("GetParameters"))
                                        )
                                    )
                                </div>
                            </div>

                            <div class="field-wrapper-half">
                                <label class="inputLabel field-label-half">Primary @Proestimator.Resources.ProStrings.ExteriorColor</label>
                                <div class="field-control-half">
                                    @Html.TextBoxFor(model => model.ExteriorColor, new { @class = "col", autocomplete = "off" })<br />
                                </div>
                            </div>

                            <div class="field-wrapper-half">
                                <label class="inputLabel field-label-half">@Proestimator.Resources.ProStrings.InteriorColor</label>
                                <div class="field-control-half">
                                    @Html.TextBoxFor(model => model.InteriorColor, new { @class = "col", autocomplete = "off" })
                                </div>
                            </div>

                            <div class="field-wrapper">
                                <label class="inputLabel field-label">Second @Proestimator.Resources.ProStrings.PaintCode</label>
                                <div class="field-control">
                                    @(Html.Kendo().DropDownList()
                                        .Name("PaintCode2")
                                        .DataTextField("Text")
                                        .DataValueField("Value")
                                        .Filter("contains")
                                        .Events(events => events
                                            .Change("PaintCode2SelectionChanged")
                                            .DataBound("PaintCodeDataChanged")
                                        )
                                        .DataSource(dataSource => dataSource
                                            .Read(read => read.Action("GetPaintCode", "Estimate").Data("GetParameters"))
                                        )
                                    )
                                </div>
                            </div>

                            <div class="field-wrapper-half">
                                <label class="inputLabel field-label-half">Second @Proestimator.Resources.ProStrings.ExteriorColor</label>
                                <div class="field-control-half">
                                    @Html.TextBoxFor(model => model.ExteriorColor2, new { @class = "col", autocomplete = "off" })<br />
                                </div>
                            </div>

                        </fieldset>

                    </div>
                </div>
            </div>

            <div id="vehicleDetails" class="half-container">

                <fieldset id="addressFieldSet">

                    @* Part 3. Vehicle Details - Bottom left form *@
                    <legend><span class="number">3</span>@Proestimator.Resources.ProStrings.VehicleDetailsHeader <span class="inlineNote">@Proestimator.Resources.ProStrings.NotRequiredNote</span> </legend>

                    <div class="field-wrapper-half">
                        <label class="inputLabel field-label-half">@Proestimator.Resources.ProStrings.MileageIn</label>
                        <div class="field-control-half">
                            @Html.TextBoxFor(model => model.MileageIn, new { @class = "col selectall", autocomplete = "off" }) <br />
                        </div>
                    </div>

                    <div class="field-wrapper-half">
                        <label class="inputLabel field-label-half">@Proestimator.Resources.ProStrings.MileageOut</label>
                        <div class="field-control-half">
                            @Html.TextBoxFor(model => model.MileageOut, new { @class = "col selectall", autocomplete = "off" })
                        </div>
                    </div>

                    <div id="kbbContainer" class="">

                    </div>

                    <div class="field-wrapper">
                        <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.EstimatedValue $</label>
                        <div class="field-control">
                            <div style="float: left; width: 70%;">
                                @Html.TextBoxFor(model => model.EstimatedValue, new { @class = "col selectall currency", @type = "tel", @placeholder = "", autocomplete = "off" })
                            </div>
                            <div style="float: left; width: 30%; padding: 5px;">
                                <a href="http://www.kbb.com" target="_blank" id="kbbValue" class="button do-not-disable" style="width: 100%; text-align: right; white-space: nowrap;">@Proestimator.Resources.ProStrings.KBBButton</a>
                            </div>
                        </div>
                    </div>

                    <div class="field-wrapper">
                        <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.LicenseNo</label>
                        <div class="field-control">
                            @Html.TextBoxFor(model => model.License, new { @class = "col text-uppercase", autocomplete = "off" })<br />
                        </div>
                    </div>

                    <div class="field-wrapper">
                        <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.LicenseState</label>
                        <div class="field-control">
                            @Html.DropDownListFor(model => model.LicenseState, Model.StateDDL)
                        </div>
                    </div>

                    <div style="clear:both;"></div>
                    <div class="field-wrapper">
                        <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.StockNumber</label>
                        <div class="field-control">
                            @Html.TextBoxFor(model => model.StockNumber, new { @class = "col text-uppercase", autocomplete = "off" })<br />
                        </div>
                    </div>

                    <div class="field-wrapper">
                        <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.EstimateNotesLabel (@Proestimator.Resources.ProStrings.Internal)</label>
                        <div class="field-control">
                            @Html.TextAreaFor(model => model.VehicleNotes, new { @class = "col", autocomplete = "off", @style = "min-height: 50px;" })
                        </div>
                    </div>

                </fieldset>

            </div>

            <div style="clear: both;"></div>

            @* Point of impact *@

            <div class="half-container">
                <fieldset>
                    <legend><span class="number">4</span>@Proestimator.Resources.ProStrings.PointOfImpact</legend>

                    <div class="field-wrapper">
                        <label class="inputLabel field-label">First @Proestimator.Resources.ProStrings.PointOfImpact</label>
                        <div class="field-control">
                            <div>
                                <svg id="POISVG1" class="poi-svg" version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 960.000000 618.000000" preserveAspectRatio="xMidYMid meet">

                                    <g transform="translate(0.000000,618.000000) scale(0.100000,-0.100000)"
                                       fill="#000000" stroke="none">

                                        <path id="Section1" d="M262 4420 c-12 -5 -30 -23 -40 -40 -11 -20 -25 -30 -40 -30 -53 0
                                        -115 -24 -148 -57 l-34 -34 0 -1150 0 -1151 21 -29 c23 -32 94 -72 148 -84 20
                                        -4 49 -23 68 -42 31 -34 35 -35 88 -31 45 4 62 10 88 36 33 32 33 32 140 32
                                        117 0 152 10 181 54 14 22 16 65 16 350 l0 324 -29 10 c-23 8 -31 19 -36 44
                                        -9 50 -1 960 9 981 4 9 16 17 26 17 15 0 18 14 23 107 4 58 7 200 7 315 0 239
                                        -4 254 -73 289 -34 18 -60 22 -142 23 -93 1 -101 3 -119 25 -35 43 -103 61
                                        -154 41z" />

                                        <path id="Section2" d="M3270 1539 c-94 -38 -294 -68 -660 -99 -459 -38 -594 -57 -779 -111
                                        -162 -46 -329 -124 -310 -144 4 -3 60 -10 124 -15 65 -6 119 -11 121 -13 1 -1
                                        -16 -51 -37 -112 l-39 -110 -155 3 -155 3 -29 -28 c-30 -31 -34 -48 -47 -209
                                        l-6 -81 32 -26 c17 -15 49 -30 70 -33 38 -6 39 -8 91 -120 l53 -114 210 2 210
                                        3 12 72 c28 165 92 304 187 401 99 101 203 144 357 145 244 1 417 -122 513
                                        -363 25 -63 57 -198 57 -240 0 -19 6 -20 130 -20 l130 0 0 25 c0 14 -6 36 -14
                                        48 -45 68 -70 189 -94 442 -16 163 15 435 66 589 18 57 22 81 14 84 -7 2 -12
                                        10 -12 18 0 16 -6 17 -40 3z" />

                                        <path id="Section3" d="M4760 2129 c-432 -13 -480 -25 -790 -199 -232 -130 -474 -270 -600
                                        -347 l-65 -40 -31 -99 c-83 -257 -94 -568 -33 -869 23 -114 49 -178 86 -217
                                        l27 -28 1296 0 1296 0 12 33 c7 17 24 68 38 112 14 44 30 84 35 89 5 6 9 17 9
                                        26 0 28 85 192 134 258 52 70 142 141 231 183 68 31 152 107 161 145 12 46 -2
                                        122 -34 187 -69 140 -262 387 -462 590 l-146 148 -69 9 c-215 29 -594 35
                                        -1095 19z" />

                                        <path id="Section4" d="M5890 2092 c0 -10 41 -55 91 -101 123 -113 240 -247 370 -421 127
                                        -170 181 -269 182 -338 1 -66 -19 -91 -119 -148 -187 -107 -268 -188 -353
                                        -354 -53 -103 -131 -324 -131 -371 l0 -29 80 0 c79 0 80 0 86 27 50 229 133
                                        387 255 489 179 150 451 144 620 -13 102 -94 188 -258 227 -430 l17 -74 347 3
                                        346 3 27 25 c15 14 32 47 41 80 24 87 31 100 57 100 80 0 126 121 96 258 -16
                                        79 -75 118 -201 137 -30 5 -48 12 -48 21 0 22 20 217 25 240 4 19 7 20 87 8
                                        46 -7 86 -10 90 -8 12 7 20 70 13 93 -28 89 -152 145 -462 211 -78 16 -162 37
                                        -188 45 -25 9 -211 98 -413 199 -202 100 -406 198 -453 218 -123 51 -284 89
                                        -519 122 -63 9 -127 18 -142 21 -22 3 -28 1 -28 -13z" />

                                        <path id="Section5" d="M8600 4366 l-125 -72 -3 -1215 -2 -1215 137 -56 136 -57 63 35 62 35
                                        37 -25 c20 -14 52 -28 69 -32 41 -7 102 17 110 43 4 14 25 25 64 36 65 18 116
                                        49 146 90 21 28 21 38 24 598 l3 569 98 0 c75 0 101 -4 111 -15 27 -32 75 -7
                                        68 36 -4 32 -33 47 -58 31 -12 -7 -57 -12 -119 -12 l-100 0 -3 553 c-3 516 -4
                                        554 -21 579 -23 34 -88 66 -150 74 -33 5 -48 12 -53 26 -18 57 -134 69 -185
                                        19 l-29 -30 -70 40 c-38 21 -73 39 -77 38 -4 0 -64 -33 -133 -73z" />

                                        <path id="Section6" d="M1489 5738 l-54 -111 -50 -13 c-74 -18 -88 -41 -80 -133 12 -162 16
                                        -181 40 -209 l23 -27 161 1 160 1 12 -31 c6 -17 23 -68 39 -112 l28 -81 -76
                                        -7 c-41 -3 -93 -6 -116 -6 -23 0 -47 -4 -55 -9 -27 -17 142 -99 302 -145 190
                                        -55 332 -75 817 -116 364 -31 567 -65 683 -115 24 -10 22 14 -8 104 -55 163
                                        -69 259 -69 486 -1 271 29 454 90 564 40 72 41 71 -110 71 l-133 0 -7 -52
                                        c-21 -163 -93 -324 -188 -420 -102 -102 -217 -148 -376 -148 -232 0 -400 123
                                        -496 364 -29 71 -56 181 -56 229 l0 27 -213 0 -213 0 -55 -112z" />

                                        <path id="Section7" d="M3309 5803 c-82 -130 -130 -503 -99 -763 16 -130 39 -237 71 -325
                                        l29 -80 83 -49 c199 -118 446 -260 625 -360 283 -158 313 -163 967 -176 414
                                        -7 670 -2 849 20 l78 10 85 76 c207 188 499 559 554 703 23 61 25 131 5 170
                                        -21 40 -92 95 -186 143 -119 61 -209 160 -283 310 -31 62 -67 151 -81 198 -15
                                        47 -33 104 -42 128 l-16 42 -1304 0 -1304 0 -31 -47z" />

                                        <path id="Section8" d="M5933 5843 c-14 -37 63 -270 138 -414 43 -83 125 -183 193 -236 23
                                        -17 84 -56 136 -85 52 -30 103 -67 114 -81 60 -80 -9 -226 -250 -527 -118
                                        -148 -227 -264 -309 -331 -68 -55 -84 -89 -42 -89 72 0 350 47 497 85 124 31
                                        185 58 618 273 200 100 392 190 425 201 34 10 118 31 187 46 177 37 339 89
                                        388 124 65 48 91 121 59 165 -12 16 -20 17 -91 6 -58 -9 -81 -9 -86 -1 -7 12
                                        -33 251 -28 256 2 2 36 11 77 19 40 8 87 23 105 33 43 26 68 82 74 169 4 60 1
                                        80 -17 117 -21 43 -66 77 -103 77 -10 0 -22 26 -36 74 -26 89 -62 126 -120
                                        126 -20 0 -174 0 -342 1 l-304 0 -26 -101 c-34 -127 -112 -287 -179 -361 -96
                                        -107 -210 -159 -349 -159 -185 0 -332 87 -438 256 -47 76 -106 227 -119 304
                                        -10 65 -18 70 -97 70 -55 0 -70 -3 -75 -17z" />

                                        <path id="Section9" d="M977 4214 c-4 -4 -7 -515 -7 -1136 l0 -1128 105 0 105 0 -2 1133 -3
                                        1132 -95 3 c-53 1 -99 0 -103 -4z" />

                                        <path id="Section10" d="M1566 4198 c-3 -7 -21 -141 -41 -298 -30 -227 -42 -295 -61 -336
                                        l-24 -51 0 -421 c0 -406 1 -423 21 -464 14 -30 35 -136 67 -348 l47 -305 865
                                        0 865 0 -1 40 c0 22 -18 117 -40 210 l-39 170 2 665 c3 715 5 752 58 985 14
                                        61 28 122 32 138 l6 27 -877 0 c-693 0 -877 -3 -880 -12z" />

                                        <path id="Section11" d="M3297 4203 c-3 -5 -8 -28 -12 -53 -8 -56 -30 -131 -44 -156 -6 -11
                                        -18 -57 -26 -104 -21 -114 -41 -1319 -25 -1450 16 -126 47 -269 69 -320 11
                                        -25 22 -61 26 -80 11 -70 -14 -72 435 36 384 92 413 100 421 123 7 16 3 77
                                        -11 183 -18 143 -20 215 -20 707 0 440 3 570 16 666 8 66 15 127 15 135 0 20
                                        -13 100 -16 100 -2 0 -186 50 -409 110 -224 61 -408 110 -411 110 -2 0 -6 -3
                                        -8 -7z" />

                                        <path id="Section12" d="M4121 3949 c-6 -19 -20 -107 -31 -197 -20 -152 -21 -203 -18 -715 3
                                        -464 7 -572 22 -677 10 -69 25 -138 33 -154 l15 -28 91 6 c470 34 912 42 1387
                                        27 195 -6 409 -14 476 -18 l121 -6 5 24 c2 13 -4 65 -13 114 -47 235 -49 272
                                        -49 777 0 444 2 496 21 604 11 66 27 145 35 177 26 100 24 101 -130 94 -72 -4
                                        -324 -12 -559 -18 -413 -12 -718 -8 -1263 18 l-131 6 -12 -34z" />

                                        <path id="Section13" d="M6940 4033 c-123 -13 -645 -143 -666 -166 -6 -7 -21 -69 -33 -138
                                        -20 -117 -21 -158 -21 -650 1 -455 3 -540 19 -647 10 -68 20 -124 22 -126 2
                                        -2 112 -31 244 -64 323 -81 452 -102 631 -102 l144 0 -2 948 -3 947 -150 1
                                        c-82 1 -166 -1 -185 -3z" />

                                        <path id="Section14" d="M6817 4097 l-599 -112 -15 -29 c-8 -15 -29 -94 -46 -175 l-31 -146
                                        -1 -530 0 -530 27 -145 c33 -175 49 -230 68 -241 8 -5 285 -58 615 -119 l600
                                        -110 331 0 330 0 27 178 c55 359 57 400 57 967 0 564 -2 600 -51 908 l-32 197
                                        -341 -1 -341 -1 -598 -111z m461 -1009 l2 -948 -144 0 c-179 0 -308 21 -631
                                        102 -132 33 -242 62 -244 64 -2 2 -12 58 -22 126 -16 107 -18 192 -19 647 0
                                        492 1 533 21 650 12 69 27 131 33 138 21 23 543 153 666 166 19 2 103 4 185 3
                                        l150 -1 3 -947z" />

                                        <path id="Section15" d="M2390 896 c-72 -18 -87 -25 -94 -42 -3 -8 -12 -14 -19 -14 -17 0
                                        -127 -108 -127 -124 0 -6 -9 -19 -20 -29 -11 -9 -20 -28 -20 -41 0 -13 -5 -26
                                        -11 -28 -6 -2 -13 -51 -16 -123 -5 -103 -3 -128 15 -175 36 -101 47 -125 60
                                        -133 6 -4 12 -15 12 -23 0 -8 11 -20 25 -26 14 -6 25 -17 25 -24 0 -8 16 -20
                                        35 -28 19 -8 35 -19 35 -23 0 -5 20 -15 44 -22 25 -7 46 -17 48 -23 2 -6 58
                                        -12 129 -14 99 -4 132 -1 155 11 16 8 37 15 46 15 23 0 68 21 68 32 0 4 7 8
                                        15 8 8 0 15 5 15 10 0 6 8 13 18 17 25 9 62 44 62 60 0 8 7 16 15 19 8 4 15
                                        12 15 20 0 8 5 14 10 14 6 0 10 9 10 20 0 11 5 20 10 20 6 0 10 11 10 24 0 13
                                        5 26 12 28 8 3 12 43 12 134 1 119 -1 134 -26 195 -16 36 -28 71 -28 77 0 7
                                        -4 12 -10 12 -5 0 -10 4 -10 9 0 11 -90 101 -101 101 -4 0 -20 11 -35 25 -15
                                        14 -37 25 -50 25 -12 0 -24 5 -26 11 -6 17 -242 21 -308 5z m200 -191 c47 -9
                                        129 -65 136 -92 4 -13 10 -23 16 -23 16 0 48 -83 48 -125 0 -58 -18 -114 -46
                                        -142 -13 -13 -24 -28 -24 -33 0 -30 -124 -90 -186 -90 -58 0 -139 37 -182 83
                                        -135 147 -69 371 125 423 26 7 55 11 63 9 8 -2 31 -6 50 -10z" />

                                        <path id="Section16" d="M6528 903 c-21 -2 -38 -8 -38 -14 0 -5 -11 -9 -24 -9 -12 0 -35 -11
                                        -50 -25 -15 -14 -31 -25 -35 -25 -5 0 -28 -20 -52 -44 -76 -76 -129 -207 -129
                                        -320 0 -75 20 -187 37 -204 7 -7 13 -22 13 -33 0 -10 5 -19 10 -19 6 0 16 -12
                                        22 -27 15 -35 69 -93 86 -93 6 0 12 -4 12 -10 0 -5 7 -10 15 -10 8 0 15 -4 15
                                        -8 0 -11 46 -32 70 -32 10 0 20 -5 22 -12 6 -18 300 -18 305 0 3 6 16 12 29
                                        12 13 0 24 5 24 10 0 6 9 10 20 10 11 0 20 5 20 11 0 5 16 17 35 25 19 8 35
                                        21 35 29 0 9 11 20 25 25 14 5 25 16 25 24 0 8 6 19 13 23 8 4 17 17 20 28 3
                                        11 18 52 31 90 30 84 34 192 10 275 -8 30 -18 67 -21 83 -3 15 -9 27 -14 27
                                        -5 0 -15 11 -21 25 -15 33 -107 125 -125 125 -7 0 -16 6 -19 14 -16 41 -204
                                        66 -366 49z m212 -205 c129 -47 202 -201 155 -325 -37 -96 -143 -173 -239
                                        -173 -44 0 -123 28 -139 49 -6 10 -20 20 -29 24 -10 3 -18 13 -18 22 0 8 -6
                                        15 -14 15 -21 0 -56 92 -56 148 0 72 48 163 108 204 78 53 153 65 232 36z" />

                                        <path id="Section17" d="M2423 6173 c-24 -2 -43 -8 -43 -12 0 -5 -20 -15 -45 -22 -25 -7 -45
                                        -17 -45 -22 0 -4 -16 -15 -35 -23 -19 -8 -35 -20 -35 -28 0 -7 -11 -18 -25
                                        -24 -14 -6 -25 -18 -25 -26 0 -8 -6 -19 -12 -23 -13 -8 -24 -32 -60 -133 -18
                                        -47 -20 -72 -15 -175 3 -72 10 -121 16 -123 6 -2 11 -15 11 -28 0 -13 9 -32
                                        20 -41 11 -10 20 -23 20 -29 0 -16 110 -124 127 -124 7 0 16 -6 19 -14 7 -18
                                        41 -31 122 -47 72 -14 275 -6 280 11 2 5 14 10 26 10 13 0 35 11 50 25 15 14
                                        31 25 35 25 11 0 101 90 101 101 0 5 5 9 10 9 6 0 10 5 10 12 0 6 12 41 28 77
                                        25 61 27 76 26 195 0 91 -4 131 -12 134 -7 2 -12 15 -12 28 0 13 -4 24 -10 24
                                        -5 0 -10 9 -10 20 0 11 -4 20 -10 20 -5 0 -10 6 -10 14 0 8 -7 16 -15 20 -8 3
                                        -15 11 -15 19 0 16 -37 51 -62 60 -10 4 -18 11 -18 17 0 5 -7 10 -15 10 -8 0
                                        -15 4 -15 8 0 11 -45 32 -68 32 -9 0 -29 6 -43 14 -26 13 -152 18 -246 9z
                                        m188 -208 c45 -16 109 -60 109 -75 0 -5 11 -20 24 -33 28 -28 46 -84 46 -142
                                        0 -42 -32 -125 -48 -125 -6 0 -13 -10 -16 -22 -8 -32 -79 -79 -142 -94 -192
                                        -44 -363 161 -285 342 54 126 192 191 312 149z" />

                                        <path id="Section18" d="M6548 6173 c-27 -2 -48 -8 -48 -14 0 -5 -9 -9 -20 -9 -24 0 -70 -21
                                        -70 -32 0 -4 -7 -8 -15 -8 -8 0 -15 -4 -15 -10 0 -5 -6 -10 -12 -10 -17 0 -71
                                        -58 -86 -92 -6 -16 -16 -28 -22 -28 -5 0 -10 -9 -10 -19 0 -11 -6 -26 -13 -33
                                        -17 -17 -37 -129 -37 -204 0 -113 53 -244 129 -320 24 -24 47 -44 52 -44 4 0
                                        20 -11 35 -25 15 -14 37 -25 50 -25 12 0 24 -5 26 -10 5 -17 208 -25 280 -11
                                        81 16 115 29 122 47 3 8 12 14 19 14 18 0 110 92 125 125 6 14 16 25 21 25 5
                                        0 11 12 14 28 3 15 13 52 21 82 24 83 20 191 -10 275 -13 39 -28 79 -31 90 -3
                                        11 -12 24 -20 28 -7 4 -13 15 -13 23 0 8 -11 19 -25 24 -14 5 -25 16 -25 25 0
                                        8 -16 21 -35 29 -19 8 -35 20 -35 25 0 6 -9 11 -20 11 -11 0 -20 5 -20 10 0 6
                                        -11 10 -24 10 -13 0 -26 4 -28 10 -3 11 -186 20 -260 13z m196 -213 c65 -25
                                        125 -85 151 -153 52 -137 -36 -294 -186 -333 -67 -17 -126 -5 -195 41 -66 43
                                        -114 131 -114 207 0 56 35 148 56 148 8 0 14 7 14 15 0 9 8 19 18 22 9 4 24
                                        15 32 25 19 23 85 46 132 47 21 1 62 -8 92 -19z" />

                                    </g>
                                </svg>

                                <p id="POISection1" class="poi-section-label"></p>
                            </div>

                            @Html.HiddenFor(model => model.POILabel1)
                        </div>
                    </div>

                    <div class="field-wrapper">
                        <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.Label</label>
                        <div class="field-control">
                            @Html.DropDownListFor(model => model.POIOption1, Model.POIDDL)
                        </div>
                    </div>

                    <div class="field-wrapper">
                        <label class="inputLabel field-label">@Proestimator.Resources.ProStrings.Custom</label>
                        <div class="field-control">
                            @Html.TextBoxFor(model => model.POICustom1)
                        </div>
                    </div>

                </fieldset>

            </div>

            <div class="half-container">
                <fieldset>
                    <legend>&nbsp;</legend>

                    <div class="field-wrapper">
                        <label class="inputLabel field-label">Second @Proestimator.Resources.ProStrings.PointOfImpact</label>
                        <div class="field-control">
                            <div>
                                <svg id="POISVG2" class="poi-svg" version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 960.000000 618.000000" preserveAspectRatio="xMidYMid meet">

                                    <g transform="translate(0.000000,618.000000) scale(0.100000,-0.100000)"
                                       fill="#000000" stroke="none">

                                        <path id="Section1" d="M262 4420 c-12 -5 -30 -23 -40 -40 -11 -20 -25 -30 -40 -30 -53 0
                                        -115 -24 -148 -57 l-34 -34 0 -1150 0 -1151 21 -29 c23 -32 94 -72 148 -84 20
                                        -4 49 -23 68 -42 31 -34 35 -35 88 -31 45 4 62 10 88 36 33 32 33 32 140 32
                                        117 0 152 10 181 54 14 22 16 65 16 350 l0 324 -29 10 c-23 8 -31 19 -36 44
                                        -9 50 -1 960 9 981 4 9 16 17 26 17 15 0 18 14 23 107 4 58 7 200 7 315 0 239
                                        -4 254 -73 289 -34 18 -60 22 -142 23 -93 1 -101 3 -119 25 -35 43 -103 61
                                        -154 41z" />

                                        <path id="Section2" d="M3270 1539 c-94 -38 -294 -68 -660 -99 -459 -38 -594 -57 -779 -111
                                        -162 -46 -329 -124 -310 -144 4 -3 60 -10 124 -15 65 -6 119 -11 121 -13 1 -1
                                        -16 -51 -37 -112 l-39 -110 -155 3 -155 3 -29 -28 c-30 -31 -34 -48 -47 -209
                                        l-6 -81 32 -26 c17 -15 49 -30 70 -33 38 -6 39 -8 91 -120 l53 -114 210 2 210
                                        3 12 72 c28 165 92 304 187 401 99 101 203 144 357 145 244 1 417 -122 513
                                        -363 25 -63 57 -198 57 -240 0 -19 6 -20 130 -20 l130 0 0 25 c0 14 -6 36 -14
                                        48 -45 68 -70 189 -94 442 -16 163 15 435 66 589 18 57 22 81 14 84 -7 2 -12
                                        10 -12 18 0 16 -6 17 -40 3z" />

                                        <path id="Section3" d="M4760 2129 c-432 -13 -480 -25 -790 -199 -232 -130 -474 -270 -600
                                        -347 l-65 -40 -31 -99 c-83 -257 -94 -568 -33 -869 23 -114 49 -178 86 -217
                                        l27 -28 1296 0 1296 0 12 33 c7 17 24 68 38 112 14 44 30 84 35 89 5 6 9 17 9
                                        26 0 28 85 192 134 258 52 70 142 141 231 183 68 31 152 107 161 145 12 46 -2
                                        122 -34 187 -69 140 -262 387 -462 590 l-146 148 -69 9 c-215 29 -594 35
                                        -1095 19z" />

                                        <path id="Section4" d="M5890 2092 c0 -10 41 -55 91 -101 123 -113 240 -247 370 -421 127
                                        -170 181 -269 182 -338 1 -66 -19 -91 -119 -148 -187 -107 -268 -188 -353
                                        -354 -53 -103 -131 -324 -131 -371 l0 -29 80 0 c79 0 80 0 86 27 50 229 133
                                        387 255 489 179 150 451 144 620 -13 102 -94 188 -258 227 -430 l17 -74 347 3
                                        346 3 27 25 c15 14 32 47 41 80 24 87 31 100 57 100 80 0 126 121 96 258 -16
                                        79 -75 118 -201 137 -30 5 -48 12 -48 21 0 22 20 217 25 240 4 19 7 20 87 8
                                        46 -7 86 -10 90 -8 12 7 20 70 13 93 -28 89 -152 145 -462 211 -78 16 -162 37
                                        -188 45 -25 9 -211 98 -413 199 -202 100 -406 198 -453 218 -123 51 -284 89
                                        -519 122 -63 9 -127 18 -142 21 -22 3 -28 1 -28 -13z" />

                                        <path id="Section5" d="M8600 4366 l-125 -72 -3 -1215 -2 -1215 137 -56 136 -57 63 35 62 35
                                        37 -25 c20 -14 52 -28 69 -32 41 -7 102 17 110 43 4 14 25 25 64 36 65 18 116
                                        49 146 90 21 28 21 38 24 598 l3 569 98 0 c75 0 101 -4 111 -15 27 -32 75 -7
                                        68 36 -4 32 -33 47 -58 31 -12 -7 -57 -12 -119 -12 l-100 0 -3 553 c-3 516 -4
                                        554 -21 579 -23 34 -88 66 -150 74 -33 5 -48 12 -53 26 -18 57 -134 69 -185
                                        19 l-29 -30 -70 40 c-38 21 -73 39 -77 38 -4 0 -64 -33 -133 -73z" />

                                        <path id="Section6" d="M1489 5738 l-54 -111 -50 -13 c-74 -18 -88 -41 -80 -133 12 -162 16
                                        -181 40 -209 l23 -27 161 1 160 1 12 -31 c6 -17 23 -68 39 -112 l28 -81 -76
                                        -7 c-41 -3 -93 -6 -116 -6 -23 0 -47 -4 -55 -9 -27 -17 142 -99 302 -145 190
                                        -55 332 -75 817 -116 364 -31 567 -65 683 -115 24 -10 22 14 -8 104 -55 163
                                        -69 259 -69 486 -1 271 29 454 90 564 40 72 41 71 -110 71 l-133 0 -7 -52
                                        c-21 -163 -93 -324 -188 -420 -102 -102 -217 -148 -376 -148 -232 0 -400 123
                                        -496 364 -29 71 -56 181 -56 229 l0 27 -213 0 -213 0 -55 -112z" />

                                        <path id="Section7" d="M3309 5803 c-82 -130 -130 -503 -99 -763 16 -130 39 -237 71 -325
                                        l29 -80 83 -49 c199 -118 446 -260 625 -360 283 -158 313 -163 967 -176 414
                                        -7 670 -2 849 20 l78 10 85 76 c207 188 499 559 554 703 23 61 25 131 5 170
                                        -21 40 -92 95 -186 143 -119 61 -209 160 -283 310 -31 62 -67 151 -81 198 -15
                                        47 -33 104 -42 128 l-16 42 -1304 0 -1304 0 -31 -47z" />

                                        <path id="Section8" d="M5933 5843 c-14 -37 63 -270 138 -414 43 -83 125 -183 193 -236 23
                                        -17 84 -56 136 -85 52 -30 103 -67 114 -81 60 -80 -9 -226 -250 -527 -118
                                        -148 -227 -264 -309 -331 -68 -55 -84 -89 -42 -89 72 0 350 47 497 85 124 31
                                        185 58 618 273 200 100 392 190 425 201 34 10 118 31 187 46 177 37 339 89
                                        388 124 65 48 91 121 59 165 -12 16 -20 17 -91 6 -58 -9 -81 -9 -86 -1 -7 12
                                        -33 251 -28 256 2 2 36 11 77 19 40 8 87 23 105 33 43 26 68 82 74 169 4 60 1
                                        80 -17 117 -21 43 -66 77 -103 77 -10 0 -22 26 -36 74 -26 89 -62 126 -120
                                        126 -20 0 -174 0 -342 1 l-304 0 -26 -101 c-34 -127 -112 -287 -179 -361 -96
                                        -107 -210 -159 -349 -159 -185 0 -332 87 -438 256 -47 76 -106 227 -119 304
                                        -10 65 -18 70 -97 70 -55 0 -70 -3 -75 -17z" />

                                        <path id="Section9" d="M977 4214 c-4 -4 -7 -515 -7 -1136 l0 -1128 105 0 105 0 -2 1133 -3
                                        1132 -95 3 c-53 1 -99 0 -103 -4z" />

                                        <path id="Section10" d="M1566 4198 c-3 -7 -21 -141 -41 -298 -30 -227 -42 -295 -61 -336
                                        l-24 -51 0 -421 c0 -406 1 -423 21 -464 14 -30 35 -136 67 -348 l47 -305 865
                                        0 865 0 -1 40 c0 22 -18 117 -40 210 l-39 170 2 665 c3 715 5 752 58 985 14
                                        61 28 122 32 138 l6 27 -877 0 c-693 0 -877 -3 -880 -12z" />

                                        <path id="Section11" d="M3297 4203 c-3 -5 -8 -28 -12 -53 -8 -56 -30 -131 -44 -156 -6 -11
                                        -18 -57 -26 -104 -21 -114 -41 -1319 -25 -1450 16 -126 47 -269 69 -320 11
                                        -25 22 -61 26 -80 11 -70 -14 -72 435 36 384 92 413 100 421 123 7 16 3 77
                                        -11 183 -18 143 -20 215 -20 707 0 440 3 570 16 666 8 66 15 127 15 135 0 20
                                        -13 100 -16 100 -2 0 -186 50 -409 110 -224 61 -408 110 -411 110 -2 0 -6 -3
                                        -8 -7z" />

                                        <path id="Section12" d="M4121 3949 c-6 -19 -20 -107 -31 -197 -20 -152 -21 -203 -18 -715 3
                                        -464 7 -572 22 -677 10 -69 25 -138 33 -154 l15 -28 91 6 c470 34 912 42 1387
                                        27 195 -6 409 -14 476 -18 l121 -6 5 24 c2 13 -4 65 -13 114 -47 235 -49 272
                                        -49 777 0 444 2 496 21 604 11 66 27 145 35 177 26 100 24 101 -130 94 -72 -4
                                        -324 -12 -559 -18 -413 -12 -718 -8 -1263 18 l-131 6 -12 -34z" />

                                        <path id="Section13" d="M6940 4033 c-123 -13 -645 -143 -666 -166 -6 -7 -21 -69 -33 -138
                                        -20 -117 -21 -158 -21 -650 1 -455 3 -540 19 -647 10 -68 20 -124 22 -126 2
                                        -2 112 -31 244 -64 323 -81 452 -102 631 -102 l144 0 -2 948 -3 947 -150 1
                                        c-82 1 -166 -1 -185 -3z" />

                                        <path id="Section14" d="M6817 4097 l-599 -112 -15 -29 c-8 -15 -29 -94 -46 -175 l-31 -146
                                        -1 -530 0 -530 27 -145 c33 -175 49 -230 68 -241 8 -5 285 -58 615 -119 l600
                                        -110 331 0 330 0 27 178 c55 359 57 400 57 967 0 564 -2 600 -51 908 l-32 197
                                        -341 -1 -341 -1 -598 -111z m461 -1009 l2 -948 -144 0 c-179 0 -308 21 -631
                                        102 -132 33 -242 62 -244 64 -2 2 -12 58 -22 126 -16 107 -18 192 -19 647 0
                                        492 1 533 21 650 12 69 27 131 33 138 21 23 543 153 666 166 19 2 103 4 185 3
                                        l150 -1 3 -947z" />

                                        <path id="Section15" d="M2390 896 c-72 -18 -87 -25 -94 -42 -3 -8 -12 -14 -19 -14 -17 0
                                        -127 -108 -127 -124 0 -6 -9 -19 -20 -29 -11 -9 -20 -28 -20 -41 0 -13 -5 -26
                                        -11 -28 -6 -2 -13 -51 -16 -123 -5 -103 -3 -128 15 -175 36 -101 47 -125 60
                                        -133 6 -4 12 -15 12 -23 0 -8 11 -20 25 -26 14 -6 25 -17 25 -24 0 -8 16 -20
                                        35 -28 19 -8 35 -19 35 -23 0 -5 20 -15 44 -22 25 -7 46 -17 48 -23 2 -6 58
                                        -12 129 -14 99 -4 132 -1 155 11 16 8 37 15 46 15 23 0 68 21 68 32 0 4 7 8
                                        15 8 8 0 15 5 15 10 0 6 8 13 18 17 25 9 62 44 62 60 0 8 7 16 15 19 8 4 15
                                        12 15 20 0 8 5 14 10 14 6 0 10 9 10 20 0 11 5 20 10 20 6 0 10 11 10 24 0 13
                                        5 26 12 28 8 3 12 43 12 134 1 119 -1 134 -26 195 -16 36 -28 71 -28 77 0 7
                                        -4 12 -10 12 -5 0 -10 4 -10 9 0 11 -90 101 -101 101 -4 0 -20 11 -35 25 -15
                                        14 -37 25 -50 25 -12 0 -24 5 -26 11 -6 17 -242 21 -308 5z m200 -191 c47 -9
                                        129 -65 136 -92 4 -13 10 -23 16 -23 16 0 48 -83 48 -125 0 -58 -18 -114 -46
                                        -142 -13 -13 -24 -28 -24 -33 0 -30 -124 -90 -186 -90 -58 0 -139 37 -182 83
                                        -135 147 -69 371 125 423 26 7 55 11 63 9 8 -2 31 -6 50 -10z" />

                                        <path id="Section16" d="M6528 903 c-21 -2 -38 -8 -38 -14 0 -5 -11 -9 -24 -9 -12 0 -35 -11
                                        -50 -25 -15 -14 -31 -25 -35 -25 -5 0 -28 -20 -52 -44 -76 -76 -129 -207 -129
                                        -320 0 -75 20 -187 37 -204 7 -7 13 -22 13 -33 0 -10 5 -19 10 -19 6 0 16 -12
                                        22 -27 15 -35 69 -93 86 -93 6 0 12 -4 12 -10 0 -5 7 -10 15 -10 8 0 15 -4 15
                                        -8 0 -11 46 -32 70 -32 10 0 20 -5 22 -12 6 -18 300 -18 305 0 3 6 16 12 29
                                        12 13 0 24 5 24 10 0 6 9 10 20 10 11 0 20 5 20 11 0 5 16 17 35 25 19 8 35
                                        21 35 29 0 9 11 20 25 25 14 5 25 16 25 24 0 8 6 19 13 23 8 4 17 17 20 28 3
                                        11 18 52 31 90 30 84 34 192 10 275 -8 30 -18 67 -21 83 -3 15 -9 27 -14 27
                                        -5 0 -15 11 -21 25 -15 33 -107 125 -125 125 -7 0 -16 6 -19 14 -16 41 -204
                                        66 -366 49z m212 -205 c129 -47 202 -201 155 -325 -37 -96 -143 -173 -239
                                        -173 -44 0 -123 28 -139 49 -6 10 -20 20 -29 24 -10 3 -18 13 -18 22 0 8 -6
                                        15 -14 15 -21 0 -56 92 -56 148 0 72 48 163 108 204 78 53 153 65 232 36z" />

                                        <path id="Section17" d="M2423 6173 c-24 -2 -43 -8 -43 -12 0 -5 -20 -15 -45 -22 -25 -7 -45
                                        -17 -45 -22 0 -4 -16 -15 -35 -23 -19 -8 -35 -20 -35 -28 0 -7 -11 -18 -25
                                        -24 -14 -6 -25 -18 -25 -26 0 -8 -6 -19 -12 -23 -13 -8 -24 -32 -60 -133 -18
                                        -47 -20 -72 -15 -175 3 -72 10 -121 16 -123 6 -2 11 -15 11 -28 0 -13 9 -32
                                        20 -41 11 -10 20 -23 20 -29 0 -16 110 -124 127 -124 7 0 16 -6 19 -14 7 -18
                                        41 -31 122 -47 72 -14 275 -6 280 11 2 5 14 10 26 10 13 0 35 11 50 25 15 14
                                        31 25 35 25 11 0 101 90 101 101 0 5 5 9 10 9 6 0 10 5 10 12 0 6 12 41 28 77
                                        25 61 27 76 26 195 0 91 -4 131 -12 134 -7 2 -12 15 -12 28 0 13 -4 24 -10 24
                                        -5 0 -10 9 -10 20 0 11 -4 20 -10 20 -5 0 -10 6 -10 14 0 8 -7 16 -15 20 -8 3
                                        -15 11 -15 19 0 16 -37 51 -62 60 -10 4 -18 11 -18 17 0 5 -7 10 -15 10 -8 0
                                        -15 4 -15 8 0 11 -45 32 -68 32 -9 0 -29 6 -43 14 -26 13 -152 18 -246 9z
                                        m188 -208 c45 -16 109 -60 109 -75 0 -5 11 -20 24 -33 28 -28 46 -84 46 -142
                                        0 -42 -32 -125 -48 -125 -6 0 -13 -10 -16 -22 -8 -32 -79 -79 -142 -94 -192
                                        -44 -363 161 -285 342 54 126 192 191 312 149z" />

                                        <path id="Section18" d="M6548 6173 c-27 -2 -48 -8 -48 -14 0 -5 -9 -9 -20 -9 -24 0 -70 -21
                                        -70 -32 0 -4 -7 -8 -15 -8 -8 0 -15 -4 -15 -10 0 -5 -6 -10 -12 -10 -17 0 -71
                                        -58 -86 -92 -6 -16 -16 -28 -22 -28 -5 0 -10 -9 -10 -19 0 -11 -6 -26 -13 -33
                                        -17 -17 -37 -129 -37 -204 0 -113 53 -244 129 -320 24 -24 47 -44 52 -44 4 0
                                        20 -11 35 -25 15 -14 37 -25 50 -25 12 0 24 -5 26 -10 5 -17 208 -25 280 -11
                                        81 16 115 29 122 47 3 8 12 14 19 14 18 0 110 92 125 125 6 14 16 25 21 25 5
                                        0 11 12 14 28 3 15 13 52 21 82 24 83 20 191 -10 275 -13 39 -28 79 -31 90 -3
                                        11 -12 24 -20 28 -7 4 -13 15 -13 23 0 8 -11 19 -25 24 -14 5 -25 16 -25 25 0
                                        8 -16 21 -35 29 -19 8 -35 20 -35 25 0 6 -9 11 -20 11 -11 0 -20 5 -20 10 0 6
                                        -11 10 -24 10 -13 0 -26 4 -28 10 -3 11 -186 20 -260 13z m196 -213 c65 -25
                                        125 -85 151 -153 52 -137 -36 -294 -186 -333 -67 -17 -126 -5 -195 41 -66 43
                                        -114 131 -114 207 0 56 35 148 56 148 8 0 14 7 14 15 0 9 8 19 18 22 9 4 24
                                        15 32 25 19 23 85 46 132 47 21 1 62 -8 92 -19z" />

                                    </g>
                                </svg>

                                <p id="POISection2" class="poi-section-label"></p>
                            </div>

                            @Html.HiddenFor(model => model.POILabel2)
                        </div>
                    </div>

                    <div class="field-wrapper">
                        <label class="inputLabel field-label">Label</label>
                        <div class="field-control">
                            @Html.DropDownListFor(model => model.POIOption2, Model.POIDDL)
                        </div>
                    </div>

                    <div class="field-wrapper">
                        <label class="inputLabel field-label">Custom</label>
                        <div class="field-control">
                            @Html.TextBoxFor(model => model.POICustom2)
                        </div>
                    </div>

                </fieldset>

            </div>

            <div class="container">

                <fieldset id="addressFieldSet">

                    @* Part 5. Accessories *@
                    <legend><span class="number">5</span>@Proestimator.Resources.ProStrings.VehicleAccessoriesHeader</legend>

                    <ul class="accessories-list">
                        @for (var i = 0; i < Model.Accessories.Count; i++)
                        {
                            <li>
                                <label>
                                    @Html.CheckBoxFor(m => m.Accessories[i].IsChecked)
                                    @Model.Accessories[i].Name
                                </label>
                            </li>
                            @Html.HiddenFor(m => m.Accessories[i].Name)
                            @Html.HiddenFor(m => m.Accessories[i].ID)
                        }
                    </ul>
                </fieldset>
            </div>

        </div>
    }
</div>

<script>
    $("#estimateForm").validate();
</script>